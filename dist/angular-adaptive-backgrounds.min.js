/*
  angular-adaptive-backgrounds v0.1.0
  http://brandly.github.io/angular-adaptive-backgrounds/
*/
(function(){angular.module("mb-adaptive-backgrounds",["ng"]).provider("adaptiveBackgroundsOptions",function(){!function(n){"use strict";var t=function(){return document.createElement("canvas").getContext("2d")},e=function(n,e){var r=new Image,a=n.src||n;"data:"!==a.substring(0,5)&&(r.crossOrigin="Anonymous"),r.onload=function(){var n=t("2d");n.drawImage(r,0,0);var a=n.getImageData(0,0,r.width,r.height);e&&e(a.data)},r.src=a},r=function(n){return["rgb(",n,")"].join("")},a=function(n){return n.map(function(n){return r(n.name)})},o=5,u=10,i={};i.colors=function(n,t){t=t||{};var i=t.exclude||[],c=t.paletteSize||u;e(n,function(e){for(var u=n.width*n.height||e.length,l={},s="",d=[],f={dominant:{name:"",count:0},palette:Array.apply(null,new Array(c)).map(Boolean).map(function(){return{name:"0,0,0",count:0}})},m=0;u>m;){if(d[0]=e[m],d[1]=e[m+1],d[2]=e[m+2],s=d.join(","),l[s]=s in l?l[s]+1:1,-1===i.indexOf(r(s))){var g=l[s];g>f.dominant.count?(f.dominant.name=s,f.dominant.count=g):f.palette.some(function(n){return g>n.count?(n.name=s,n.count=g,!0):void 0})}m+=4*o}if(t.success){var p=a(f.palette);t.success({dominant:r(f.dominant.name),secondary:p[0],palette:p})}})},n.RGBaster=n.RGBaster||i}(window);var n;return n={parentClass:null,exclude:["rgb(0,0,0)","rgba(255,255,255)"],normalizeTextColor:!1,normalizedTextColors:{light:"#fff",dark:"#000"},lumaClasses:{light:"ab-light",dark:"ab-dark"}},{set:function(t){return angular.extend(n,t)},$get:function(){return n}}}).directive("adaptiveBackground",function(n,t){var e,r;return r=t,e=function(t){return n.getComputedStyle(t,null).getPropertyValue("background-image").replace("url(","").replace(")","")},{restrict:"A",link:function(n,t,a){var o,u,i,c,l,s;return c=t[0],s=function(){return null!=a.abCssBackground},u=function(){var n,e;if(e=a.abParentClass||r.parentClass)for(n=t.parent();n[0]!==document;){if(n.hasClass(e))return n;n=n.parent()}return t.parent()},l=function(n){var t;return t=u(),t.css("backgroundColor",n)},o=function(n){return RGBaster.colors(n,{paletteSize:20,exclude:r.exclude,success:function(n){return l(n.dominant,n.palette)}})},s()?o(e(c)):(i=function(){return o(c)},t.on("load",i),n.$on("$destroy",function(){return t.off("load",i)}),i())}}})}).call(this);
/*
  angular-adaptive-backgrounds v0.2.1
  http://brandly.github.io/angular-adaptive-backgrounds/
*/
(function(){angular.module("mb-adaptive-backgrounds",["ng"]).provider("adaptiveBackgroundsOptions",function(){!function(n){"use strict";var t=function(){return document.createElement("canvas").getContext("2d")},e=function(n,e){var a=new Image,r=n.src||n;"data:"!==r.substring(0,5)&&(a.crossOrigin="Anonymous"),a.onload=function(){var n=t("2d");n.drawImage(a,0,0);var r=n.getImageData(0,0,a.width,a.height);e&&e(r.data)},a.src=r},a=function(n){return["rgb(",n,")"].join("")},r=function(n){return n.map(function(n){return a(n.name)})},o=5,u=10,i={};i.colors=function(n,t){t=t||{};var i=t.exclude||[],c=t.paletteSize||u;e(n,function(e){for(var u=n.width*n.height||e.length,l={},d="",s=[],m={dominant:{name:"",count:0},palette:Array.apply(null,new Array(c)).map(Boolean).map(function(){return{name:"0,0,0",count:0}})},g=0;u>g;){if(s[0]=e[g],s[1]=e[g+1],s[2]=e[g+2],d=s.join(","),l[d]=d in l?l[d]+1:1,-1===i.indexOf(a(d))){var f=l[d];f>m.dominant.count?(m.dominant.name=d,m.dominant.count=f):m.palette.some(function(n){return f>n.count?(n.name=d,n.count=f,!0):void 0})}g+=4*o}if(t.success){var p=r(m.palette);t.success({dominant:a(m.dominant.name),secondary:p[0],palette:p})}})},n.RGBaster=n.RGBaster||i}(window);var n;return n={imageClass:null,exclude:["rgb(0,0,0)","rgba(255,255,255)"],normalizeTextColor:!1,normalizedTextColors:{light:"#fff",dark:"#000"},lumaClasses:{light:"ab-light",dark:"ab-dark"}},{set:function(t){return angular.extend(n,t)},$get:function(){return n}}}).directive("adaptiveBackground",function(n,t){var e,a;return a=t,e=function(t){return n.getComputedStyle(t,null).getPropertyValue("background-image").replace("url(","").replace(")","")},{restrict:"A",link:function(n,t,r){var o,u,i,c,l,d,s;return d=t[0],s=function(n){return"IMG"!==n.tagName},i=function(){var n,e;return e=r.abImageClass||a.imageClass,angular.element(null!=e&&(n=d.querySelector("."+e),null!=n)?n:t.find("img")[0])},o=function(e){return RGBaster.colors(e,{paletteSize:20,exclude:a.exclude,success:function(e){return n.adaptiveBackgroundColors=e,t.css("backgroundColor",e.dominant)}})},u=i(),l=u[0],s(l)?o(e(l)):(c=function(){return l.src?o(l):void 0},u.on("load",c),n.$on("$destroy",function(){return u.off("load",c)}),c())}}})}).call(this);
/*
  angular-adaptive-backgrounds v0.2.1
  http://brandly.github.io/angular-adaptive-backgrounds/
*/
(function(){angular.module("mb-adaptive-backgrounds",["ng"]).provider("adaptiveBackgroundsOptions",function(){!function(n){"use strict";var a=function(){return document.createElement("canvas").getContext("2d")},e=function(n,e){var t=new Image,r=n.src||n;"data:"!==r.substring(0,5)&&(t.crossOrigin="Anonymous"),t.onload=function(){var n=a("2d");n.drawImage(t,0,0);var r=n.getImageData(0,0,t.width,t.height);e&&e(r.data)},t.src=r},t=function(n){return["rgb(",n,")"].join("")},r=function(n){return n.map(function(n){return t(n.name)})},u=5,o=10,i={};i.colors=function(n,a){a=a||{};var i=a.exclude||[],c=a.paletteSize||o;e(n,function(e){for(var o=n.width*n.height||e.length,l={},s="",d=[],m={dominant:{name:"",count:0},palette:Array.apply(null,new Array(c)).map(Boolean).map(function(){return{name:"0,0,0",count:0}})},g=0;o>g;){if(d[0]=e[g],d[1]=e[g+1],d[2]=e[g+2],s=d.join(","),l[s]=s in l?l[s]+1:1,-1===i.indexOf(t(s))){var f=l[s];f>m.dominant.count?(m.dominant.name=s,m.dominant.count=f):m.palette.some(function(n){return f>n.count?(n.name=s,n.count=f,!0):void 0})}g+=4*u}if(a.success){var v=r(m.palette);a.success({dominant:t(m.dominant.name),secondary:v[0],palette:v})}})},n.RGBaster=n.RGBaster||i}(window);var n;return n={imageClass:null,exclude:["rgb(0,0,0)","rgba(255,255,255)"],lumaClasses:{light:"ab-light-background",dark:"ab-dark-background"}},{set:function(a){return angular.extend(n,a)},$get:function(){return n}}}).directive("adaptiveBackground",function(n,a){var e,t,r,u;return u=a,t=function(a){return n.getComputedStyle(a,null).getPropertyValue("background-image").replace("url(","").replace(")","")},e=/\d+/g,r=function(n){var a;return a=n.match(e),(299*a[0]+587*a[1]+114*a[2])/1e3},{restrict:"A",link:function(n,a,e){var o,i,c,l,s,d,m,g;return d=a[0],g=function(n){return"IMG"!==n.tagName},c=function(){var n,t;return t=e.abImageClass||u.imageClass,angular.element(null!=t&&(n=d.querySelector("."+t),null!=n)?n:a.find("img")[0])},m=function(e){var t;return a.css("backgroundColor",e.dominant),t=r(e.dominant),128>=t?(a.addClass(u.lumaClasses.dark),a.removeClass(u.lumaClasses.light)):(a.addClass(u.lumaClasses.light),a.removeClass(u.lumaClasses.dark)),e.backgroundYIQ=t,n.adaptiveBackgroundColors=e},o=function(n){return RGBaster.colors(n,{paletteSize:20,exclude:u.exclude,success:m})},i=c(),s=i[0],g(s)?o(t(s)):(l=function(){return s.src?o(s):void 0},i.on("load",l),n.$on("$destroy",function(){return i.off("load",l)}),l())}}})}).call(this);